export default class GameModel{constructor(e){this.view=e,this.canvasWidth=900,this.canvasHeight=600,this.cellSize=75,this.cellGap=2.5,this.enemiesInterval=600,this.frame=0,this.frameBack=0,this.frameNextLevel=0,this.numberOfResources=300,this.gameOver=!1,this.levelComplete=!1,this.win=!1,this.userName=null,this.score=0,this.levelGame=1,this.winningScore=100,this.animateID=null,this.gameStart=!1,this.images={},this.addImage=(e,i)=>{this.images[e]=new Image,this.images[e].src=i},this.addImage("clouds_2","img/game_background/clouds_2.png"),this.addImage("clouds_2_1","img/game_background/clouds_2_1.png"),this.addImage("clouds_2_2","img/game_background/clouds_2_2.png"),this.addImage("ground_1","img/game_background/ground_1.png"),this.addImage("ground_2","img/game_background/ground_2.png"),this.addImage("ground_3","img/game_background/ground_3.png"),this.addImage("plant","img/game_background/plant.png"),this.addImage("rocks","img/game_background/rocks.png"),this.addImage("sky","img/game_background/sky.png"),this.addImage("background_1","img/battle-backgrounds/game_background_1.jpg"),this.addImage("background_2","img/battle-backgrounds/game_background_2.jpg"),this.addImage("background_3","img/battle-backgrounds/game_background_3.jpg"),this.addImage("background_4","img/battle-backgrounds/game_background_4.jpg"),this.addImage("spellsEffect_1","img/protecting_char/Spells-Effect_1.png"),this.addImage("spellsEffect_2","img/protecting_char/Spells-Effect_2.png"),this.addImage("spellsEffect_3","img/protecting_char/Spells-Effect_3.png"),this.addImage("wraith_01","img/protecting_char/Wraith_01.png"),this.addImage("wraith_02","img/protecting_char/Wraith_02.png"),this.addImage("wraith_03","img/protecting_char/Wraith_03.png"),this.addImage("fallen_Angels_01","img/attacking_char/Fallen_Angels_01.png"),this.addImage("fallen_Angels_02","img/attacking_char/Fallen_Angels_02.png"),this.addImage("fallen_Angels_03","img/attacking_char/Fallen_Angels_03.png"),this.addImage("golem_01","img/attacking_char/Golem_01.png"),this.addImage("golem_02","img/attacking_char/Golem_02.png"),this.addImage("golem_03","img/attacking_char/Golem_03.png"),this.addImage("reaper_Man_01","img/protecting_char/Reaper_Man_01.png"),this.addImage("reaper_Man_02","img/protecting_char/Reaper_Man_02.png"),this.addImage("reaper_Man_03","img/protecting_char/Reaper_Man_03.png"),this.addImage("Orc_01","img/attacking_char/Orc_01.png"),this.addImage("Orc_02","img/attacking_char/Orc_02.png"),this.addImage("Orc_03","img/attacking_char/Orc_03.png"),this.addImage("coin","img/coins/dark_coin.png"),this.addImage("score","img/coins/score.png"),this.addImage("up_01","img/coins/up_01.png"),this.addImage("up_02","img/coins/up_02.png"),this.addImage("nav_game_button","img/buttons/Nav_Game_Button.png"),this.gameGrid=[],this.navGrid=[],this.defenders=[],this.dyingDefenders=[],this.enemies=[],this.dyingEnemies=[],this.enemyPosition=[],this.enemyPositionX=[],this.projectiles=[],this.resources=[],this.amounts=[20,30,40],this.gameBackground=null,this.gameBattleBackground=null,this.arrUsers=[],this.choiceDefender="wraith",this.mouse={x:10,y:10,width:.07,height:.07},this.controlsBar={width:this.canvasWidth,height:1.5*this.cellSize,availableHeight:3*this.cellSize},this.blank=()=>{1!==this.levelGame&&2!==this.levelGame&&3!==this.levelGame||(this.gameBattleBackground=this.images.background_1),4!==this.levelGame&&5!==this.levelGame&&6!==this.levelGame||(this.gameBattleBackground=this.images.background_2),7!==this.levelGame&&8!==this.levelGame&&9!==this.levelGame||(this.gameBattleBackground=this.images.background_4),this.view.blank(this.gameBattleBackground)},this.handleGameGrid=()=>{for(let e=0;e<this.gameGrid.length;e++)this.gameGrid[e].draw()},this.handleNavGrid=()=>{for(let e=0;e<this.navGrid.length;e++)this.navGrid[e].draw()},this.handleGameStatus=()=>{if(this.score>=this.winningScore&&0===this.enemies.length&&"win"!==this.levelGame?this.levelComplete=!0:this.levelComplete=!1,this.levelComplete&&(this.frameNextLevel++,0!==this.frameNextLevel&&this.frameNextLevel%180==0&&this.levelGame<10&&(this.score+=Math.round(this.numberOfResources/10),this.numberOfResources+=300,this.nextLevelGame())),this.levelComplete&&10===this.levelGame){this.levelGame="win",this.levelComplete=!1,this.win=!0;let e=!1;this.view.continueBlock(!1),this.view.pause=!1;for(let i=0;i<this.arrUsers.length;i++)if(Math.round(this.score)>+this.arrUsers[i].points){this.deleteUser(this.arrUsers[9].id),this.addUser(this.userName,Math.round(this.score)),this.view.thisUser=this.userName,this.view.usersScore=Math.round(this.score),this.view.renderContent("addLeader"),e=!0,setTimeout(()=>this.view.start(!1),3e3);break}e||setTimeout(()=>this.view.start(!1),3e3)}this.view.drawGameStatus(this.score,this.numberOfResources,this.levelComplete,this.gameOver,this.images.coin,this.images.score,this.images.up_01,this.images.up_02,this.images.wraith_01,this.images.reaper_Man_01,this.win)},this.handleEnemies=()=>{for(let e=0;e<this.enemies.length;e++)if(this.enemies[e].draw(),this.enemies[e].update(),this.enemies[e].x<0&&(this.gameOver=!0),this.enemies[e].health<=0){let i=Math.ceil(this.enemies[e].maxHealth/15),t=this.enemies[e].maxHealth/10;this.numberOfResources+=i,this.score+=t;const s=this.enemyPosition.indexOf(this.enemies[e].y);this.dyingEnemies.push(this.newDyingEnemies(this.enemies[e].x,this.enemies[e].y,this.enemies[e].image[0],this)),this.enemyPosition.splice(s,1),this.enemies.splice(e,1),e--}if(this.frame%this.enemiesInterval==0&&this.score<this.winningScore){if(1===this.levelGame||2===this.levelGame||3===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.Orc_01,110,.1)),this.enemyPosition.push(e)}if(4===this.levelGame||5===this.levelGame||6===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.fallen_Angels_01,130,.1)),this.enemyPosition.push(e)}if(7===this.levelGame||8===this.levelGame||9===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.golem_01,150,.1)),this.enemyPosition.push(e)}this.enemiesInterval>200&&(this.enemiesInterval-=50)}if(0!==this.frame&&this.frame%350==0&&this.score<this.winningScore){if(2===this.levelGame||3===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.Orc_02,160,.15)),this.enemyPosition.push(e)}if(5===this.levelGame||6===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.fallen_Angels_02,180,.15)),this.enemyPosition.push(e)}if(8===this.levelGame||9===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.golem_02,200,.15)),this.enemyPosition.push(e)}}if(0!==this.frame&&this.frame%590==0&&this.score<this.winningScore){if(3===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.Orc_03,210,.2)),this.enemyPosition.push(e)}if(6===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.fallen_Angels_03,230,.2)),this.enemyPosition.push(e)}if(9===this.levelGame){let e=Math.floor(4*Math.random()+3)*this.cellSize+this.cellGap;this.enemies.push(this.newEnemy(e,this,this.images.golem_03,250,.2)),this.enemyPosition.push(e)}}},this.handleDyingEnemies=()=>{for(let e=0;e<this.dyingEnemies.length;e++)this.dyingEnemies[e].draw(),this.dyingEnemies[e].update(),this.dyingEnemies[e].animDying&&(this.dyingEnemies.splice(e,1),e--)},this.handleDefenders=()=>{for(let e=0;e<this.defenders.length;e++){this.defenders[e].draw(),this.defenders[e].update(),-1!==this.enemyPosition.indexOf(this.defenders[e].y)?this.defenders[e].shooting=!0:this.defenders[e].shooting=!1;for(let i=0;i<this.enemies.length;i++)if(this.defenders[e]&&this.collision(this.defenders[e],this.enemies[i])&&(this.enemies[i].movement=0,this.defenders[e].health-=this.enemies[i].power,"reaper_Man"===this.defenders[e].nameDefender&&(this.enemies[i].health-=this.defenders[e].powerCloseAtack)),this.defenders[e]&&this.defenders[e].health<=0){this.dyingDefenders.push(this.newDyingDefender(this.defenders[e].x,this.defenders[e].y,this.defenders[e].image[0],this)),this.defenders.splice(e,1),e--;for(let e=0;e<this.enemies.length;e++)this.enemies[e].movement=this.enemies[e].speed}}},this.handleDyingDefenders=()=>{for(let e=0;e<this.dyingDefenders.length;e++)this.dyingDefenders[e].draw(),this.dyingDefenders[e].update(),this.dyingDefenders[e].animDying&&(this.dyingDefenders.splice(e,1),e--)},this.handleProjectiles=()=>{for(let e=0;e<this.projectiles.length;e++){this.projectiles[e].update(),this.projectiles[e].draw();for(let i=0;i<this.enemies.length;i++)this.enemies[i]&&this.projectiles[e]&&this.collision(this.projectiles[e],this.enemies[i])&&(this.enemies[i].health-=this.projectiles[e].power,this.projectiles.splice(e,1),e--);this.projectiles[e]&&this.projectiles[e].x>this.canvasWidth-this.cellSize&&(this.projectiles.splice(e,1),e--)}},this.handleResources=()=>{this.frame%500==0&&this.score<this.winningScore&&this.resources.push(this.newResource(this));for(let e=0;e<this.resources.length;e++)this.resources[e].draw(),this.resources[e].update(),this.resources[e]&&this.mouse.x&&this.mouse.y&&this.collision(this.resources[e],this.mouse)&&(this.gameStart&&this.createGameSound("audio/resourse.mp3"),this.numberOfResources+=this.resources[e].amount,this.resources.splice(e,1),e--)},this.handlegameBackground=()=>{this.gameBackground.draw(),this.gameBackground.update()},this.animate=()=>{if(this.blank(),this.view.drawControlsBar(this.controlsBar.width,this.controlsBar.height),this.handleGameGrid(),this.handleNavGrid(),this.handleDefenders(),this.handleDyingDefenders(),this.handleProjectiles(),this.handleEnemies(),this.handleDyingEnemies(),this.handleResources(),this.handleGameStatus(),this.frame++,this.gameOver){cancelAnimationFrame(this.animateID),this.score+=Math.ceil(this.numberOfResources/10),this.numberOfResources=0;let e=!1;this.view.continueBlock(!1),this.view.pause=!1;for(let i=0;i<this.arrUsers.length;i++)if(this.score>+this.arrUsers[i].points){this.deleteUser(this.arrUsers[9].id),this.addUser(this.userName,this.score),this.view.thisUser=this.userName,this.view.usersScore=this.score,this.view.renderContent("addLeader"),e=!0,setTimeout(()=>this.view.start(!1),2e3);break}e||setTimeout(()=>this.view.start(!1),2e3)}else this.animateID=requestAnimationFrame(this.animate)},this.animateBackground=()=>{this.handlegameBackground(),this.frameBack++,requestAnimationFrame(this.animateBackground)}}init(){this.createGrid(),this.gameBackground=this.newGameBackground(this),this.animateBackground()}newCell(e,i,t){return new class{constructor(e,i){this.x=e,this.y=i,this.width=t.cellSize,this.height=t.cellSize}draw(){t.mouse.x&&t.mouse.y&&t.collision(this,t.mouse)&&t.view.drawCell(this.x,this.y,this.width,this.height)}}(e,i,t)}newNavCell(e,i,t,s,h){return new class{constructor(e,i,t,s,h){this.x=e,this.y=i,this.width=50,this.height=50,this.choice=!1,this.isButton=s,this.imgButton=h}draw(){t.mouse.x&&t.mouse.y&&t.collision(this,t.mouse)&&!this.isButton&&t.view.drawNavCell(this.x,this.y,this.width,this.height,"white"),this.choice&&!this.isButton&&t.view.drawNavCell(this.x,this.y,this.width,this.height,"gold"),"menu"===this.isButton&&(this.choice?t.view.drawNavButton(h,60,0,60,60,this.x,this.y,this.width,this.height):t.view.drawNavButton(h,0,0,60,60,this.x,this.y,this.width,this.height)),"pause"===this.isButton&&(this.choice?t.view.drawNavButton(h,60,60,60,60,this.x,this.y,this.width,this.height):t.view.drawNavButton(h,0,60,60,60,this.x,this.y,this.width,this.height))}}(e,i,t,s,h)}createGrid(){for(let e=3*this.cellSize;e<this.canvasHeight-this.cellSize;e+=this.cellSize)for(let i=0;i<this.canvasWidth;i+=this.cellSize)this.gameGrid.push(this.newCell(i,e,this));this.navGrid.push(this.newNavCell(300,3,this,!1,!1)),this.navGrid.push(this.newNavCell(300,56,this,!1,!1)),this.navGrid[0].choice=!0,this.navGrid.push(this.newNavCell(840,3,this,"menu",this.images.nav_game_button)),this.navGrid.push(this.newNavCell(840,56,this,"pause",this.images.nav_game_button))}newEnemy(e,i,t,s,h){return new class{constructor(e,i,t,s,h){this.x=i.canvasWidth,this.y=e,this.width=i.cellSize-2*i.cellGap,this.height=i.cellSize-2*i.cellGap,this.speed=.2*Math.random()+.4,this.movement=this.speed,this.health=s,this.maxHealth=this.health,this.power=h,this.frameX=267.916667,this.frameY=170,this.charFrameX=0,this.charFrameY=0,this.image=[t,30,0,this.frameX,this.frameY,this.x,this.y,90,this.height]}draw(){i.view.drawEnemy(this.image,this.health)}update(){this.image[1]=this.frameX*this.charFrameX+20,this.image[2]=this.frameY*this.charFrameY,this.image[5]=this.x,this.image[6]=this.y,this.charFrameX<11&&i.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(i.gameStart&&1===this.charFrameY&&i.createGameSound("audio/fight_2.mp3"),this.charFrameX=0);for(let e=0;e<i.defenders.length;e++)this.health>0&&i.collision(this,i.defenders[e])&&(i.defenders[e].fight=!0),this.health<=0&&i.collision(this,i.defenders[e])&&(i.defenders[e].fight=!1);0===this.movement?this.charFrameY=1:this.charFrameY=0,this.x-=this.movement}}(e,i,t,s,h)}newDyingEnemies(e,i,t,s){return new class{constructor(e,i,t,s){this.x=e,this.y=i,this.height=s.cellSize-2*s.cellGap,this.animDying=!1,this.frameX=267.916667,this.frameY=170,this.charFrameX=0,this.charFrameY=2,this.image=[t,20,0,this.frameX,this.frameY,this.x,this.y,90,this.height]}draw(){s.view.drawDyingEnemy(this.image)}update(){this.image[1]=this.frameX*this.charFrameX+20,this.image[2]=this.frameY*this.charFrameY+10,this.charFrameX<11&&s.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(this.animDying=!0)}}(e,i,t,s)}newDefender(e,i,t,s){class h{constructor(e,i,t,s){this.x=e,this.y=i,this.width=t.cellSize-2*t.cellGap,this.height=t.cellSize-2*t.cellGap,this.nameDefender=s,this.shooting=!1,this.health=50,this.projectiles=[],this.imgProjectil=t.images.spellsEffect_1,this.timer=0,this.powerAtack=5,this.level=1,this.costUp=25,this.frameX=267.916667,this.frameY=170,this.charFrameX=0,this.charFrameY=0,this.image=[t.images.wraith_01,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],t.gameStart&&t.createGameSound("audio/wicher.mp3")}draw(){t.view.drawDefender(this.image,this.health)}update(){this.image[1]=this.frameX*this.charFrameX,this.image[2]=this.frameY*this.charFrameY,this.charFrameX<11&&t.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(this.charFrameX=0),this.shooting?(this.charFrameY=1,this.timer++,this.timer%66==0&&(t.projectiles.push(t.newProjectile(this.x+55,this.y+35,this.imgProjectil,this.powerAtack,t)),t.gameStart&&t.createGameSound("audio/atack.mp3"))):(this.timer=0,this.charFrameY=0)}up(){return 1===this.level&&t.numberOfResources>=this.costUp?(t.numberOfResources-=this.costUp,this.health+=15,this.imgProjectil=t.images.spellsEffect_2,this.powerAtack=10,this.level++,this.image=[t.images.wraith_02,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],void(t.gameStart&&t.createGameSound("audio/update.mp3"))):2===this.level&&t.numberOfResources>=this.costUp?(t.numberOfResources-=this.costUp,this.health+=25,this.imgProjectil=t.images.spellsEffect_3,this.powerAtack=15,this.level++,this.image=[t.images.wraith_03,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],void(t.gameStart&&t.createGameSound("audio/update.mp3"))):void 0}}class a{constructor(e,i,t,s){this.x=e,this.y=i,this.width=t.cellSize-2*t.cellGap,this.height=t.cellSize-2*t.cellGap,this.nameDefender=s,this.fight=!1,this.health=80,this.powerCloseAtack=.1,this.level=1,this.costUp=25,this.frameX=267.916667,this.frameY=170,this.charFrameX=0,this.charFrameY=0,this.image=[t.images.reaper_Man_01,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],t.gameStart&&t.createGameSound("audio/reaper_man.mp3")}draw(){t.view.drawDefender(this.image,this.health)}update(){this.image[1]=this.frameX*this.charFrameX,this.image[2]=this.frameY*this.charFrameY,this.charFrameX<11&&t.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(t.gameStart&&1===this.charFrameY&&t.createGameSound("audio/fight_1.mp3"),this.charFrameX=0),this.fight?this.charFrameY=1:this.charFrameY=0}up(){return 1===this.level&&t.numberOfResources>=this.costUp?(t.numberOfResources-=this.costUp,this.health+=30,this.powerCloseAtack=.15,this.level++,this.image=[t.images.reaper_Man_02,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],void(t.gameStart&&t.createGameSound("audio/update.mp3"))):2===this.level&&t.numberOfResources>=this.costUp?(t.numberOfResources-=this.costUp,this.health+=60,this.powerCloseAtack=.2,this.level++,this.image=[t.images.reaper_Man_03,0,0,this.frameX,this.frameY,this.x,this.y,100,this.height],void(t.gameStart&&t.createGameSound("audio/update.mp3"))):void 0}}return"wraith"===s?new h(e,i,t,s):new a(e,i,t,s)}newDyingDefender(e,i,t,s){return new class{constructor(e,i,t,s){this.x=e,this.y=i,this.height=s.cellSize-2*s.cellGap,this.animDying=!1,this.frameX=267.916667,this.frameY=170,this.charFrameX=0,this.charFrameY=2,this.image=[t,20,0,this.frameX,this.frameY,this.x,this.y,100,this.height]}draw(){s.view.drawDyingDefender(this.image)}update(){this.image[1]=this.frameX*this.charFrameX,this.image[2]=this.frameY*this.charFrameY,this.charFrameX<11&&s.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(this.animDying=!0)}}(e,i,t,s)}click(e){e.y>this.controlsBar.availableHeight&&e.y<this.canvasHeight-this.cellSize&&!1===this.navGrid[3].choice?this.createDefender():e.x>300&&e.x<350&&!1===this.navGrid[3].choice?(e.y>3&&e.y<53&&(this.navGrid[0].choice=!0,this.navGrid[1].choice=!1,this.choiceDefender="wraith",this.gameStart&&this.createGameSound("audio/click.mp3")),e.y>56&&e.y<106&&(this.navGrid[1].choice=!0,this.navGrid[0].choice=!1,this.choiceDefender="reaper_Man",this.gameStart&&this.createGameSound("audio/click.mp3"))):e.x>840&&e.x<890&&(e.y>3&&e.y<53&&(1==this.navGrid[2].choice?this.navGrid[2].choice=!1:this.navGrid[2].choice=!0,this.gameStart&&this.createGameSound("audio/click.mp3"),this.gameStart=!1,this.navGrid[3].choice=!0,this.view.pause=!0,cancelAnimationFrame(this.animateID),this.handleNavGrid(),this.view.continueBlock(!0),this.view.start(!1)),e.y>56&&e.y<106&&(!1===this.navGrid[3].choice?(this.navGrid[3].choice=!0,this.view.pause=!0,cancelAnimationFrame(this.animateID),this.handleNavGrid(),this.gameStart&&this.createGameSound("audio/click.mp3"),this.gameStart=!1):(this.navGrid[3].choice=!1,this.view.pause=!1,this.animateID=requestAnimationFrame(this.animate),this.gameStart=!0,this.gameStart&&this.createGameSound("audio/click.mp3"))))}createDefender(){const e=this.mouse.x-this.mouse.x%this.cellSize+this.cellGap,i=this.mouse.y-this.mouse.y%this.cellSize+this.cellGap;if(i<this.controlsBar.height||i>this.canvasHeight-this.cellSize)return;for(let t=0;t<this.defenders.length;t++)if(this.defenders[t].x===e&&this.defenders[t].y===i)return void this.defenders[t].up();this.numberOfResources>=50&&(this.defenders.push(this.newDefender(e,i,this,this.choiceDefender)),this.numberOfResources-=50)}newProjectile(e,i,t,s,h){return new class{constructor(e,i,t,s,h){this.x=e,this.y=i,this.width=20,this.height=20,this.power=s,this.speed=5}update(){this.x+=this.speed}draw(){h.view.drawProjectile(t,this.x,this.y,this.width,this.height)}}(e,i,t,s,h)}newResource(e){return new class{constructor(e){this.x=Math.random()*(e.canvasWidth-e.cellSize),this.y=(Math.floor(4*Math.random())+3)*e.cellSize+25,this.width=.6*e.cellSize,this.height=.6*e.cellSize,this.amount=e.amounts[Math.floor(Math.random()*e.amounts.length)],this.frameX=90,this.frameY=90,this.charFrameX=0,this.image=[e.images.coin,0,0,this.frameX,this.frameY,this.x,this.y,this.width,this.height]}draw(){e.view.drawResource(this.image,this.amount)}update(){this.image[1]=this.frameX*this.charFrameX,this.charFrameX<11&&e.frame%6==0&&this.charFrameX++,this.charFrameX>=11&&(this.charFrameX=0)}}(e)}newGameBackground(e){return new class{constructor(e){this.clouds_2_1_x=.5,this.clouds_2_2_x=.5,this.image_clouds_2_1=[e.images.clouds_2_1],this.image_clouds_2_2=[e.images.clouds_2_2],this.speed_1=.5,this.speed_2=-.5}draw(){this.image_clouds_2_1[1]=this.clouds_2_1_x,this.image_clouds_2_2[1]=this.clouds_2_2_x,e.view.drawBackground(e.images.sky,this.image_clouds_2_1,e.images.rocks,e.images.clouds_2,this.image_clouds_2_2,e.images.ground_1,e.images.ground_2,e.images.ground_3,e.images.plant)}update(){e.frameBack%2==0&&(this.clouds_2_1_x+=this.speed_1,this.clouds_2_2_x+=this.speed_2),0!==e.frameBack&&e.frameBack%3800==0&&(this.speed_1=-1*this.speed_1,this.speed_2=-1*this.speed_2)}}(e)}zeroingLevel(){this.defenders.length=0,this.dyingDefenders.length=0,this.enemies.length=0,this.dyingEnemies.length=0,this.enemyPosition.length=0,this.enemyPositionX.length=0,this.projectiles.length=0,this.resources.length=0}nextLevelGame(){if(this.levelGame++,this.levelGame<10)switch(this.levelGame){case 2:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+150;break;case 3:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+200;break;case 4:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+250;break;case 5:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+300;break;case 6:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+350;break;case 7:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+400;break;case 8:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+450;break;case 9:this.zeroingLevel(),this.frame=0,this.winningScore=this.score+500}}collision(e,i){if(!(e.x>i.x+i.width||e.x+e.width<i.x||e.y>i.y+i.height||e.y+e.height<i.y))return!0}resize(){this.view.resize()}updateState(){if(null===window.localStorage.getItem("Funny_Defenders_Undead"))window.location.hash="#getName",this.view.renderContent("getName");else{let e=JSON.parse(window.localStorage.getItem("Funny_Defenders_Undead"));this.userName=e.name;const i=window.location.hash.slice(1).toLowerCase();this.view.renderContent(i)}}start(){this.navGrid[2].choice=!1,this.navGrid[3].choice=!1,this.view.continueBlock(!1),cancelAnimationFrame(this.animateID),this.enemiesInterval=600,this.frame=0,this.frameNextLevel=0,this.numberOfResources=300,this.gameOver=!1,this.levelComplete=!1,this.win=!1,this.score=0,this.levelGame=1,this.winningScore=100,this.gameGrid=[],this.defenders=[],this.dyingDefenders=[],this.enemies=[],this.dyingEnemies=[],this.enemyPosition=[],this.projectiles=[],this.resources=[],this.blank(),this.view.start(!0),this.gameStart=!0,this.view.pause=!1,setTimeout(this.animate(),1e3)}continue(){this.navGrid[2].choice=!1,this.handleNavGrid(),this.view.start(!0),this.gameStart=!0}deleteUser(e){myAppDB.ref(`users/user_${e}}`).remove().then((function(){console.log("Пользователь удален из коллеции users")})).catch((function(e){console.error("Ошибка удаления пользователя: ",e)}))}addUser(e,i){let t=Math.round(1e6*Math.random());myAppDB.ref(`users/user_${t}}`).set({username:""+e,points:""+i,id:t}).then((function(e){console.log("Пользователь добавлен в коллецию users")})).catch((function(e){console.error("Ошибка добавления пользователя: ",e)}))}getUsersList(e){myAppDB.ref("users/").on("value",(function(i){e.updateUsersData(i.val())}),(function(e){console.log("Error: "+e.code)}))}updateUsersData(e){let i=Object.keys(e),t=[];for(let s=0;s<i.length;s++)t.push(e[""+i[s]]);t.sort((function(e,i){return+e.points<+i.points?1:+e.points>+i.points?-1:0})),this.arrUsers=t,console.log(this.arrUsers),this.view.users=this.arrUsers,this.updateState()}playAudioBack(){this.view.playAudioBack()}mutedAudioBack(e){this.view.mutedAudioBack(e)}playAudioGame(){this.view.playAudioGame()}isMuted(e){this.view.isMuted(e),this.view.closeSaund(e)}createGameSound(e){this.view.createGameSound(e)}loadAudio(){this.view.loadAudio()}}