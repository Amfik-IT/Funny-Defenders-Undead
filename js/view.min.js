export default class GameView{constructor(t,s,a){this.container=t,this.canvas=s,this.ctx=this.canvas.getContext("2d"),this.canvasWidth=900,this.canvasHeight=600,this.canvasBack=a,this.ctx_2=this.canvasBack.getContext("2d"),this.canvasBackPozition=t.getBoundingClientRect(),this.users=null,this.thisUser=null,this.usersScore=null,this.audioBack=null,this.audioGame=null,this.muted=!1,this.pause=!1,this.HomeComponent={id:"menu",title:"Funny Defenders Undead",render:(t="menu",...s)=>`\n                <section class="${t}">\n                    <ul class="mainmenu__list">\n                        <li><a class="new__game">Новая игра</a></li>\n                        <li><a id="continue" class="continue save__true">Продолжить</a></li>\n                        <li><a class="mainmenu__link" href="#rules">Правила игры</a></li>\n                        <li><a class="mainmenu__link" href="#leaders">Таблица лидеров</a></li>\n                        <li><span class="saund__off-top"></span><a id="sound" class="sound">Звук</a><span class="saund__off-bottom"></span></li>\n                    </ul>\n                </section>\n              `},this.RulesComponent={id:"rules",title:"Правила игры",render:(t="menu",...s)=>`\n                <section class="${t}">\n                    <a class="mainmenu__link back" href="#menu">Назад</a>\n                    <div class="rules__text">\n                    <p>В начале игры у вас есть стартовое количество темной материи для строительства защитников, а в процессе она будет появляться в случайних местах на поле битвы, и даваться за каждое убийство врага.</p>\n                    <p>Расходуйте темную материю с умом, её остаток переходит на следующий уровень и очень там пригодится ;)</p><br>\n                    <p>Что бы установить защитника, выберите его на панели навигации и кликните левой кнопкой мыши на участок поля где вы хотите его разместить.</p>\n                    <p>Защитников можно улучшать - это сделает их сильнее! Для этого кликните по нему левой кнопкой мыши.</p><br> \n                    <p>Wraith - имеет одиночную, дальнюю атаку</p>\n                    <p>Reaper Man - массовую, но вблизи врага.</p><br> \n                    <p>Игра будет окончена если противник доберется до противополжного края арены.</p><br> \n                    Удачной игры =)</div>\n                </section>\n              `},this.LeadersComponent={id:"leaders",title:"Таблица лидеров",render:(t="menu",...s)=>`\n                <section class="${t}">\n                    <a class="mainmenu__link back" href="#menu">Назад</a>\n                    <ul class="users">\n                        <li class="user1">\n                            <span class="name">1) ${this.users[0].username}</span>\n                            <span class="points">${this.users[0].points}</span>\n                        </li>\n                        <li class="user2">\n                            <span class="name">2) ${this.users[1].username}</span>\n                            <span class="points">${this.users[1].points}</span>\n                        </li>\n                        <li class="user3">\n                            <span class="name">3) ${this.users[2].username}</span>\n                            <span class="points">${this.users[2].points}</span>\n                        </li>\n                        <li class="user4">\n                            <span class="name">4) ${this.users[3].username}</span>\n                            <span class="points">${this.users[3].points}</span>\n                        </li>\n                        <li class="user5">\n                            <span class="name">5) ${this.users[4].username}</span>\n                            <span class="points">${this.users[4].points}</span>\n                        </li>\n                        <li class="user6">\n                            <span class="name">6) ${this.users[5].username}</span>\n                            <span class="points">${this.users[5].points}</span>\n                        </li>\n                        <li class="user7">\n                            <span class="name">7) ${this.users[6].username}</span>\n                            <span class="points">${this.users[6].points}</span>\n                        </li>\n                        <li class="user8">\n                            <span class="name">8) ${this.users[7].username}</span>\n                            <span class="points">${this.users[7].points}</span>\n                        </li>\n                        <li class="user9">\n                            <span class="name">9) ${this.users[8].username}</span>\n                            <span class="points">${this.users[8].points}</span>\n                        </li>\n                        <li class="user10">\n                            <span class="name">10) ${this.users[9].username}</span>\n                            <span class="points">${this.users[9].points}</span>\n                        </li>\n                    </ul>\n                </section>\n              `},this.getNameComponent={id:"name",title:"Имя игрока",render:(t="menu",...s)=>`\n                <section class="${t}">\n                    <p>Твое имя, герой:</p>\n                    <input type="text" class="input__name" id="newUserName" name="username" placeholder="Введите имя" maxlength="10" required>\n                    <a class="add__name" href="#menu">Ок</a>\n                </section>\n              `},this.addLeadersComponent={id:"newLeader",title:"Новый лидер",render:(t="menu",...s)=>`\n                <section class="${t}">\n                    <p>Встречайте нового героя!!!  <span>${this.thisUser}</span>  вы набрали <span>${this.usersScore}</span> очков  и попали в таблицу лидеров!</p>\n                    <a class="new__leaders" href="#leaders">Я лучший =)</a>\n                </section>\n              `},this.router={menu:this.HomeComponent,rules:this.RulesComponent,leaders:this.LeadersComponent,default:this.HomeComponent,addLeader:this.addLeadersComponent,getName:this.getNameComponent}}init(){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvasBack.width=this.canvasBackPozition.width,this.canvasBack.height=this.canvasBackPozition.height;let t=document.createElement("main");t.setAttribute("id","main"),this.canvasBack.after(t)}blank(t){this.ctx.drawImage(t,0,0,this.canvasWidth,this.canvasHeight)}drawControlsBar(t,s){this.ctx.fillStyle="#7d7d7d80",this.ctx.fillRect(0,0,t,s)}drawGameStatus(t,s,a,e,i,n,o,c,h,r,l){this.ctx.drawImage(n,20,10,50,50),this.ctx.drawImage(i,0,0,90,90,20,60,50,50),this.ctx.drawImage(h,20,0,267.916667,180,300,3,60,50),this.ctx.drawImage(r,20,0,267.916667,180,300,56,60,50),this.ctx.drawImage(o,0,0,100,100,430,3,50,50),this.ctx.drawImage(o,0,0,100,100,430,56,50,50),this.ctx.drawImage(c,0,0,100,100,560,3,50,50),this.ctx.drawImage(c,0,0,100,100,560,56,50,50),this.ctx.save(),this.ctx.shadowColor="white",this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=7,this.ctx.fillStyle="black",this.ctx.font="50.5px RUSNeverwinter",this.ctx.globalAlpha=.8,this.ctx.fillText(""+Math.round(t),100,45),this.ctx.fillText(s+" $",100,90),this.ctx.restore(),this.ctx.save(),this.ctx.shadowColor="white",this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=7,this.ctx.fillStyle="black",this.ctx.font="25.5px RUSNeverwinter",this.ctx.fillText("50 xp",360,15),this.ctx.fillText("5 atc",360,30),this.ctx.fillText("50 $",360,45),this.ctx.fillText("80 xp",360,70),this.ctx.fillText("6 atc/s",360,85),this.ctx.fillText("50 $",360,100),this.ctx.fillText("+15 xp",490,15),this.ctx.fillText("10 atc",490,30),this.ctx.fillText("25 $",490,45),this.ctx.fillText("+30 xp",490,70),this.ctx.fillText("9 atc/s",490,85),this.ctx.fillText("25 $",490,100),this.ctx.fillText("+25 xp",620,15),this.ctx.fillText("15 atc",620,30),this.ctx.fillText("25 $",620,45),this.ctx.fillText("+60 xp",620,70),this.ctx.fillText("12 atc/s",620,85),this.ctx.fillText("25 $",620,100),this.ctx.restore(),e&&(this.ctx.fillStyle="black",this.ctx.font="50px Lineage2Font",this.ctx.fillText("Game Over",350,330)),a&&!l&&(this.ctx.fillStyle="black",this.ctx.font="50px Lineage2Font",this.ctx.fillText("Level Complete",300,330)),l&&(this.ctx.fillStyle="black",this.ctx.font="50px Lineage2Font",this.ctx.fillText("!!! You're a winner !!!",250,330))}drawEnemy(t,s){this.ctx.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]),this.ctx.save(),this.ctx.strokeStyle="rgba(0,0,0,0.77)",this.ctx.lineCap="round",this.ctx.lineWidth=5.5,this.ctx.beginPath(),this.ctx.moveTo(t[5]+80,t[6]+60),this.ctx.lineTo(t[5]+80,t[6]+(50-s/5)+10),this.ctx.stroke(),this.ctx.strokeStyle="red",this.ctx.lineCap="round",this.ctx.lineWidth=3.5,this.ctx.beginPath(),this.ctx.moveTo(t[5]+80,t[6]+60),this.ctx.lineTo(t[5]+80,t[6]+(50-s/5)+10),this.ctx.stroke(),this.ctx.restore()}drawDyingEnemy(t){this.ctx.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}drawCell(t,s,a,e){this.ctx.strokeStyle="transparent",this.ctx.strokeRect(t,s,a,e)}drawNavCell(t,s,a,e,i){this.ctx.strokeStyle=""+i,this.ctx.strokeRect(t,s,a,e)}drawNavButton(t,s,a,e,i,n,o,c,h){this.ctx.drawImage(t,s,a,e,i,n,o,c,h)}drawDefender(t,s){this.ctx.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]),this.ctx.save(),this.ctx.strokeStyle="rgba(0,0,0,0.77)",this.ctx.lineCap="round",this.ctx.lineWidth=5.5,this.ctx.beginPath(),this.ctx.moveTo(t[5]+20,t[6]+60),this.ctx.lineTo(t[5]+20,t[6]+(50-s/5)+10),this.ctx.stroke(),this.ctx.strokeStyle="green",this.ctx.lineCap="round",this.ctx.lineWidth=3.5,this.ctx.beginPath(),this.ctx.moveTo(t[5]+20,t[6]+60),this.ctx.lineTo(t[5]+20,t[6]+(50-s/5)+10),this.ctx.stroke(),this.ctx.restore()}drawDyingDefender(t){this.ctx.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}drawProjectile(t,s,a,e,i){this.ctx.drawImage(t,s,a,e,i)}drawResource(t,s){this.ctx.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}drawBackground(t,s,a,e,i,n,o,c,h){this.ctx_2.drawImage(t,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(s[0],s[1],0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(a,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(e,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(i[0],i[1],0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(n,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(o,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(c,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height),this.ctx_2.drawImage(h,0,0,this.canvasBackPozition.width,this.canvasBackPozition.height)}playAudioBack(){this.audioBack=new Audio,"probably"==this.audioBack.canPlayType("audio/mp3")?this.audioBack.src="audio/rage-zone-k1.mp3":this.audioBack.src="audio/rage-zone-k1.ogg",this.audioBack.loop=!0,this.audioBack.autoplay=!0,this.audioBack.volume=.3}mutedAudioBack(t){this.audioBack.muted=t}playAudioGame(){this.pause?(this.mutedAudioGame(!1),this.muted&&this.mutedAudioGame(!0),this.muted||this.mutedAudioBack(!0)):(this.audioGame=new Audio,"probably"==this.audioGame.canPlayType("audio/mp3")?this.audioGame.src="audio/rage-zone-hierarchy&quad&masterkey.mp3":this.audioGame.src="audio/rage-zone-hierarchy&quad.ogg",this.audioGame.loop=!0,this.audioGame.autoplay=!0,this.audioGame.volume=.3,this.muted&&this.mutedAudioGame(!0),this.muted||this.mutedAudioBack(!0))}mutedAudioGame(t){this.audioGame.muted=t}isMuted(t){this.muted=t}closeSaund(t){let s=this.container.querySelector(".sound"),a=this.container.querySelector(".saund__off-top"),e=this.container.querySelector(".saund__off-bottom");t?(s.classList.toggle("red"),setTimeout(()=>{a.style.opacity="1",a.style.transform="rotate(45deg) translateX(50%)"},700),setTimeout(()=>{e.style.opacity="1",e.style.transform="rotate(-45deg) translateX(50%)"},700),a.animate([{transform:"rotate(0deg) translateX(50%)",opacity:0},{transform:"rotate(45deg) translateX(50%)",opacity:1}],{duration:700,iterations:1}),e.animate([{transform:"rotate(0deg) translateX(50%)",opacity:0},{transform:"rotate(-45deg) translateX(50%)",opacity:1}],{duration:700,iterations:1})):t||(s.classList.toggle("red"),setTimeout(()=>{a.style.opacity="0",a.style.transform="rotate(0deg) translateX(50%)"},700),setTimeout(()=>{e.style.opacity="0",e.style.transform="rotate(0deg) translateX(50%)"},700),a.animate([{transform:"rotate(45deg) translateX(50%)",opacity:1},{transform:"rotate(0deg) translateX(50%)",opacity:0}],{duration:700,iterations:1}),e.animate([{transform:"rotate(-45deg) translateX(50%)",opacity:1},{transform:"rotate(0deg) translateX(50%)",opacity:0}],{duration:700,iterations:1}))}createGameSound(t){if(!this.muted){let s=new Audio;s.src=""+t,s.volume="audio/update.mp3"===t||"audio/wicher.mp3"===t?.2:.3,s.autoplay=!0}}loadAudio(){new Audio("audio/atack.mp3").preload="auto",new Audio("audio/click.mp3").preload="auto",new Audio("audio/fight_1.mp3").preload="auto",new Audio("audio/fight_2.mp3").preload="auto",new Audio("audio/rage-zone-hierarchy&quad&masterkey.mp3").preload="auto",new Audio("audio/rage-zone-k1.mp3").preload="auto",new Audio("audio/reaper_man.mp3").preload="auto",new Audio("audio/resourse.mp3").preload="auto",new Audio("audio/update.mp3").preload="auto",new Audio("audio/wicher.mp3").preload="auto"}resize(){this.canvasBackPozition=container.getBoundingClientRect(),this.canvasBack.width=this.canvasBackPozition.width,this.canvasBack.height=this.canvasBackPozition.height}renderContent(t){let s="default";t.length>0&&(s=t in this.router?t:"error"),window.document.title=this.router[s].title;let a=document.querySelector("#main");a.innerHTML=this.router[s].render(s+"-page menuWindow"),a.style.opacity=1,setTimeout(()=>{let t=a.querySelector(`.${s}-page`);null!==t?t.style.opacity=1:a.querySelector(".addLeader-page").style.opacity=1},0),"menu"===s&&this.muted&&this.closeSaund(!0),"menu"===s&&this.pause&&this.continueBlock(!0)}start(t){t?(this.canvas.classList.toggle("show"),setTimeout(this.canvas.style.opacity="1",1e3),this.canvas.animate([{opacity:0},{opacity:1}],{duration:1e3,iterations:1})):(this.muted||this.mutedAudioBack(!1),this.muted||this.mutedAudioGame(!0),setTimeout(this.canvas.style.opacity="0",1e3),this.canvas.animate([{opacity:1},{opacity:0}],{duration:1e3,iterations:1}),this.canvas.classList.toggle("show"))}continueBlock(t){let s=this.container.querySelector(".continue");t?s.classList.remove("save__true"):s.classList.add("save__true")}}